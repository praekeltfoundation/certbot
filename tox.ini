[tox]
envlist = py{27,34,35,36,py,py3},pep8,py3pep8

[testenv]
extras =
    test
deps =
    coverage
# In order to build cryptography for PyPy on macOS, these variables need to be
# passed: https://cryptography.io/en/latest/installation/#building-cryptography-on-macos
passenv = CFLAGS LDFLAGS
commands =
    coverage run -m pytest {posargs}
    coverage report -m

# These targets disable coverage on PyPy because of performance problems with
# coverage.py on PyPy.
[testenv:pypy-nocoverage]
commands =
    pytest {posargs}

[testenv:pypy3-nocoverage]
commands =
    pytest {posargs}

[testenv:pep8]
extras =
    pep8test
commands =
    flake8 .

[testenv:py3pep8]
basepython = python3
extras =
    pep8test
commands =
    flake8 .

[flake8]
application-import-names = marathon_acme

[pytest]
# Native tracebacks make testtools matcher failures more readable
addopts = --tb=native
